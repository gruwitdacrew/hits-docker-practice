# Многофункциональное веб-приложение для заказа еды

## Общее описание

Проект представляет собой полнофункциональное веб-приложение для заказа еды, разработанное с использованием ASP.NET Core. Приложение предоставляет пользователям возможность просматривать меню, добавлять блюда в корзину, создавать заказы и управлять личным кабинетом. Администраторы могут управлять меню, обрабатывать заказы и просматривать аналитику.

## Архитектура приложения

### Стек технологий
- **Backend**: ASP.NET Core 8.0
- **Frontend**: HTML, CSS, JavaScript, Razor Pages
- **ORM**: Entity Framework Core
- **База данных**: Microsoft SQL Server
- **Аутентификация**: ASP.NET Core Identity
- **Тестирование**: xUnit, Moq
- **Контейнеризация**: Docker, Docker Compose
- **CI/CD**: GitHub Actions

### Структура проекта
```
Application/
├── Mockups/                 # Основное веб-приложение
│   ├── Controllers/         # MVC контроллеры
│   ├── Models/             # Модели представления (ViewModels)
│   ├── Views/              # Razor представления
│   ├── Services/           # Бизнес-логика
│   ├── Repositories/       # Репозитории для работы с данными
│   ├── Storage/            # Модели данных и контекст БД
│   ├── Migrations/         # Миграции БД
│   ├── Configs/            # Конфигурационные классы
│   ├── Helpers/            # Вспомогательные классы
│   ├── Properties/         # Свойства проекта
│   ├── wwwroot/            # Статические файлы
│   ├── Mockups.csproj      # Файл проекта
│   └── Program.cs          # Точка входа
├── Mockups.Tests/          # Тесты
│   ├── UnitTest/           # Модульные тесты
│   └── LoadTest/           # Нагрузочные тесты
└── Mockups.sln             # Решение Visual Studio
```

### Ключевые компоненты

#### Контроллеры
- `AccountController` — управление аккаунтом пользователя (регистрация, вход, профиль)
- `MenuController` — отображение и управление меню
- `CartController` — работа с корзиной
- `OrdersController` — создание и отображение заказов
- `OrdersManagementController` — управление заказами (для администраторов)
- `AnalyticsController` — статистика просмотров товаров
- `AdminAnalyticsController` — аналитика для администраторов

#### Модели данных
- `User` — пользователь системы
- `MenuItem` — элемент меню (блюдо)
- `Order` — заказ пользователя
- `Address` — адрес пользователя
- `Role` — роли пользователей (Пользователь, Администратор)

#### Бизнес-логика
- `UsersService` — управление пользователями
- `MenuItemsService` — работа с меню
- `OrdersService` — обработка заказов
- `AddressesService` — работа с адресами
- `AnalyticsService` — сбор и обработка аналитики

#### Аутентификация и авторизация
Приложение использует ASP.NET Core Identity для управления пользователями и ролями. Пользователи могут регистрироваться, входить в систему и управлять своим профилем. Администраторы имеют расширенные права для управления содержимым и заказами.

## Запуск приложения

### Локальный запуск

#### Требования
- .NET 8.0 SDK
- Microsoft SQL Server или SQL Server Express LocalDB
- Docker (опционально)

#### Инструкции
1. Клонируйте репозиторий:
   ```bash
   git clone <repository_url>
   cd hits-docker-practice
   cd Application
   ```

2. Восстановите зависимости:
   ```bash
   dotnet restore
   ```

3. Выполните миграции базы данных:
   ```bash
   dotnet ef database update --project ./Mockups/Mockups.csproj
   ```

4. Запустите приложение:
   ```bash
   dotnet run --project ./Mockups/Mockups.csproj
   ```

5. Приложение будет доступно по адресу `https://localhost:7146` или `http://localhost:5146`

### Запуск с использованием Docker

1. Убедитесь, что у вас установлен Docker
2. В корне проекта выполните:
   ```bash
   docker-compose up --build
   ```
3. Приложение будет доступно по адресу `http://localhost:5146`

## Тестирование

### Модульные тесты
Модульные тесты расположены в `Application/Mockups.Tests/UnitTest/` и используют фреймворк xUnit. Для запуска:
```bash
dotnet test ./Application/Mockups.Tests/UnitTest/Mockups.Tests.csproj
```

### Нагрузочные тесты
Нагрузочные тесты расположены в `Application/Mockups.Tests/LoadTest/` и имитируют реальных пользователей, использующих приложение. Для запуска:
```bash
dotnet run --project ./Application/Mockups.Tests/LoadTest/LoadTest.csproj
```

## CI/CD Pipeline

Проект включает автоматизированный CI/CD процесс с использованием GitHub Actions:

1. **Unit тестирование** — запуск модульных тестов
2. **Сборка и деплой** — сборка Docker-образа и деплой приложения
3. **Нагрузочное тестирование** — тестирование производительности на развернутом приложении

### Настройка CI/CD
Файл `.github/workflows/ci-cd-pipeline.yml` содержит определение пайплайна. Для корректной работы необходимо настроить self-hosted runner.

## Особенности приложения

### Функциональные особенности
- Регистрация и аутентификация пользователей
- Управление профилем и адресами
- Просмотр меню с возможностью сортировки
- Добавление блюд в корзину и оформление заказов
- Отслеживание статуса заказов
- Администрирование меню и заказов
- Система аналитики просмотров товаров

### Технические особенности
- Паттерн Repository для работы с данными
- Внедрение зависимостей (DI)
- Миграции Entity Framework
- Защита от CSRF
- Асинхронная обработка запросов
- Логирование действий
- Обработка исключений

## Конфигурация
Основные настройки находятся в `appsettings.json`:
- ConnectionStrings — строка подключения к БД
- AdminCreds — учетные данные администратора
- OrderTimeParams — параметры времени доставки
- CartsCleaner — настройки очистки корзин

## Безопасность
- Защита от XSS и CSRF атак
- Валидация входных данных
- Шифрование паролей
- Права доступа к контроллерам
- Проверка ролей пользователей